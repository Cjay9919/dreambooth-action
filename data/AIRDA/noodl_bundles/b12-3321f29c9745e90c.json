[{"name":"/App/Studios/Edit Studio","nodes":[{"id":"7c69981d-91c6-f89e-da62-2fe6aad803f5","type":"Page","parameters":{},"ports":[],"children":[{"id":"8066f7af-877c-4d3f-8f16-8d69a8a17e38","type":"/Header","parameters":{},"ports":[],"children":[]},{"id":"3fe37167-ac7f-b0c6-e7ff-48040db30a9d","type":"Group","parameters":{"scrollEnabled":true,"nativeScroll":false,"scrollSnapEnabled":true,"scrollSnapToEveryItem":true,"marginLeft":{"value":5,"unit":"px"},"marginRight":{"value":5,"unit":"px"},"alignX":"center"},"ports":[],"children":[{"id":"eccc439d-6370-5c4e-3903-cb35696a0729","type":"Text","parameters":{"textStyle":"Title Large","text":"Edit Studio"},"ports":[],"children":[]},{"id":"d7087614-3c70-60bb-4cce-d34df67436e7","type":"Group","parameters":{"marginLeft":{"value":5,"unit":"px"},"marginRight":{"value":5,"unit":"px"},"width":{"value":100,"unit":"%"},"alignX":"center","sizeMode":"contentHeight","marginTop":{"value":5,"unit":"px"},"marginBottom":{"value":5,"unit":"px"}},"ports":[],"children":[{"id":"1e8c8496-0a2a-05ab-580d-381dab6cd502","type":"net.noodl.controls.options","parameters":{"label":"Space Select","marginTop":{"value":5,"unit":"px"},"marginBottom":{"value":5,"unit":"px"},"items":"[\n    {\"Label\":\"Kitchen\", \"Value\":\"Kitchen\"},\n    {\"Label\":\"Bedroom\", \"Value\":\"Bedroom\"},\n    {\"Label\":\"Living Room\", \"Value\":\"Living Room\"}, \n    {\"Label\":\"Bathroom\", \"Value\":\"Bathroom\"},\n    {\"Label\":\"Garden\", \"Value\":\"Garden\"}, \n    {\"Label\":\"Internal Room\", \"Value\":\"Internal Room\"},\n    {\"Label\":\"External Space\", \"Value\":\"External Space\"}\n]"},"ports":[],"children":[]},{"id":"798ac0f3-db43-1e16-9afc-9aeff7b21531","type":"net.noodl.controls.button","parameters":{"label":"Upload Image","backgroundColor":"Black"},"ports":[],"children":[]},{"id":"d9ab89bd-2cd5-f6c9-9254-7ccafb2431f6","type":"Image","parameters":{"sizeMode":"explicit","marginLeft":{"value":20,"unit":"px"},"marginRight":{"value":20,"unit":"px"},"marginBottom":{"value":10,"unit":"px"},"marginTop":{"value":10,"unit":"px"},"borderRadius":{"value":4,"unit":"px"}},"ports":[],"children":[]},{"id":"95ab55ea-6375-7d2a-fe64-e113282b6390","type":"net.noodl.controls.button","parameters":{"label":"Select Area","marginTop":{"value":5,"unit":"px"},"backgroundColor":"transparent","borderStyle":"solid","color":"#000000"},"ports":[],"children":[]},{"id":"c26c5ffb-1eba-6c72-b955-f7c3bc0f478e","type":"Group","parameters":{"flexDirection":"column","sizeMode":"contentHeight","marginTop":{"value":20,"unit":"px"},"marginBottom":{"value":10,"unit":"px"}},"ports":[],"children":[{"id":"2ec985f7-24bd-0fe6-b339-b8d9700433a7","type":"Text","parameters":{"text":"X axsis","textStyle":"Label Small","textTransform":"uppercase"},"ports":[],"children":[]},{"id":"0d183183-f593-d66f-71d5-d793067debba","type":"net.noodl.controls.range","parameters":{"marginTop":{"value":5,"unit":"px"},"marginBottom":{"value":10,"unit":"px"},"max":10,"thumbColor":"Black","trackColor":"Light Gray","trackActiveColor":"Black"},"ports":[],"children":[]},{"id":"d20063c8-b0c5-afca-67e5-656ce1667f21","type":"Text","parameters":{"text":"Y AXSIS","textStyle":"Label Small"},"ports":[],"children":[]},{"id":"c0681fba-d43f-c233-31e3-f48f22a148ba","type":"net.noodl.controls.range","parameters":{"marginTop":{"value":5,"unit":"px"},"marginBottom":{"value":10,"unit":"px"},"max":10,"thumbColor":"Black","trackColor":"Light Gray","trackActiveColor":"Black"},"ports":[],"children":[]}]},{"id":"a03806d7-0ae5-63af-605e-22d270794861","type":"Group","parameters":{"backgroundColor":"#FFFFFF","mounted":false},"ports":[],"children":[{"id":"2374149a-d8b0-9507-d6c5-0d7bc133f270","type":"Image","parameters":{"borderRadius":{"value":4,"unit":"px"},"marginLeft":{"value":10,"unit":"px"},"marginTop":{"value":10,"unit":"px"},"marginRight":{"value":10,"unit":"px"},"marginBottom":{"value":10,"unit":"px"}},"ports":[],"children":[]}]},{"id":"22bb9f7d-a36b-54a2-4a6b-0a24cdb9289a","type":"net.noodl.controls.textinput","parameters":{"marginTop":{"value":5,"unit":"px"},"marginBottom":{"value":5,"unit":"px"},"type":"textArea","sizeMode":"explicit","height":{"value":250,"unit":"px"},"mounted":true,"label":"Description"},"ports":[],"children":[]},{"id":"455d0e8d-55fe-4f53-ef50-9d03613f311b","type":"net.noodl.controls.button","parameters":{"label":"generate","textTransform":"uppercase","color":"#FFFFFF","backgroundColor":"#000000","borderStyle":"none","marginTop":{"value":5,"unit":"px"},"marginBottom":{"value":5,"unit":"px"}},"ports":[],"children":[]}]},{"id":"fb5b099a-98e2-ffbf-ed8a-a5b1372fb19c","type":"Group","parameters":{},"ports":[],"children":[{"id":"23fef3a0-3d07-9ab2-913d-e9e4eb6518b5","type":"Image","parameters":{"sizeMode":"explicit"},"ports":[],"children":[]}]}]},{"id":"552b1ece-b21a-1a41-53ed-90e98ce1ffc4","type":"/Bottom Nav","parameters":{},"ports":[],"children":[]}]},{"id":"6eb25c0e-c150-7734-8a1c-62770ee929a2","type":"PageInputs","parameters":{},"ports":[],"children":[]},{"id":"2b253457-10a6-77f0-4727-1f3299887187","type":"JavaScriptFunction","parameters":{"functionScript":"// Check if the file input is not null and is an image\r\nif (Inputs.file && Inputs.file.type.match('image.*')) {\r\n    var reader = new FileReader();\r\n\r\n    // When the file is read, set the Data URL to the output\r\n    reader.onload = function (e) {\r\n        Outputs.imageUrl = e.target.result;\r\n    };\r\n\r\n    // Read the file\r\n    reader.readAsDataURL(Inputs.file);\r\n} else {\r\n    Outputs.imageUrl = null; // Clear the output if no file is selected or file is not an image\r\n}\r\n"},"ports":[{"name":"in-file","displayName":"file","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-imageUrl","displayName":"imageUrl","plug":"output","type":"*","group":"Outputs","index":5}],"children":[]},{"id":"7d0a7734-e903-e212-9179-8968384a5153","type":"NavigationClosePopup","parameters":{"closeActions":"Cancel,Image Selected","results":"Image File,Image Url"},"ports":[],"children":[]},{"id":"8d3d505c-f024-9a69-4854-7a74271b4b9f","type":"Open File Picker","parameters":{},"ports":[],"children":[]},{"id":"ebd67145-161c-8edc-4283-d8d07f46ecfd","type":"NavigationShowPopup","parameters":{"target":"/#Image Cropper/Example Usage/Cropper Popup"},"ports":[],"children":[]},{"id":"77be894a-7c07-fc54-5f06-6f01c2899036","type":"Variable2","parameters":{"name":"Current Avatar File"},"ports":[],"children":[]},{"id":"437615fa-1359-9a4a-d438-18e0b6f9e548","type":"Condition","parameters":{},"ports":[],"children":[]},{"id":"2fa845ae-e128-0f2f-3a02-307928b4c5f6","type":"Expression","parameters":{"expression":"val"},"ports":[],"children":[]},{"id":"17b670d6-92b7-f334-c9fe-e2bf71c3a2f7","type":"Set Variable","parameters":{"name":"Current Avatar File"},"ports":[],"children":[]},{"id":"3dc9e418-b63a-fb75-49c7-232e8891a438","type":"Variable2","parameters":{"name":"Current Avatar Url"},"ports":[],"children":[]},{"id":"d1c3d9e6-ad6e-33ed-cf96-310fd466f104","type":"Set Variable","parameters":{"name":"Current Avatar Url"},"ports":[],"children":[]},{"id":"afc5944e-4d61-03a3-fb5d-ba7ffeb29983","type":"JavaScriptFunction","parameters":{"functionScript":"// Assume `blobUrl` is the input holding the Blob URL of the image you want to convert\r\nconst blobUrl = Inputs.blobUrl;\r\n\r\nfetch(blobUrl)\r\n    .then(response => response.blob()) // Convert the response to a Blob (binary large object)\r\n    .then(blob => {\r\n        // Ensure the blob is treated as a PNG image\r\n        const pngBlob = new Blob([blob], { type: 'image/png' });\r\n\r\n        // Use FileReader to read the blob as a Data URL (base64)\r\n        var reader = new FileReader();\r\n        reader.onload = function() {\r\n            // Once the blob is read as Data URL, output it\r\n            Outputs.dataUrl = reader.result;\r\n        };\r\n        reader.readAsDataURL(pngBlob);\r\n    })\r\n    .catch(error => {\r\n        console.error('Error converting Blob URL to PNG Data URL:', error);\r\n        Outputs.dataUrl = null; // Handle errors or invalid Blob URLs appropriately\r\n    });\r\n"},"ports":[{"name":"in-blobUrl","displayName":"blobUrl","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-dataUrl","displayName":"dataUrl","plug":"output","type":"*","group":"Outputs","index":5}],"children":[]},{"id":"5f18768d-34e6-b08a-c778-b65273cdfebe","type":"/#XanoPrefab/Xano/Base/Xano - Request GEN In_Img","parameters":{"Request Type":"POST"},"ports":[],"children":[]}],"connections":[{"sourceId":"8d3d505c-f024-9a69-4854-7a74271b4b9f","sourcePort":"file","targetId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","targetPort":"popupParam-File"},{"sourceId":"8d3d505c-f024-9a69-4854-7a74271b4b9f","sourcePort":"name","targetId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","targetPort":"popupParam-File Name"},{"sourceId":"77be894a-7c07-fc54-5f06-6f01c2899036","sourcePort":"value","targetId":"2fa845ae-e128-0f2f-3a02-307928b4c5f6","targetPort":"val"},{"sourceId":"2fa845ae-e128-0f2f-3a02-307928b4c5f6","sourcePort":"result","targetId":"437615fa-1359-9a4a-d438-18e0b6f9e548","targetPort":"condition"},{"sourceId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","sourcePort":"closeResult-Image File","targetId":"17b670d6-92b7-f334-c9fe-e2bf71c3a2f7","targetPort":"value"},{"sourceId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","sourcePort":"closeAction-Image Selected","targetId":"17b670d6-92b7-f334-c9fe-e2bf71c3a2f7","targetPort":"do"},{"sourceId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","sourcePort":"closeResult-Image Url","targetId":"d1c3d9e6-ad6e-33ed-cf96-310fd466f104","targetPort":"value"},{"sourceId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","sourcePort":"closeAction-Image Selected","targetId":"d1c3d9e6-ad6e-33ed-cf96-310fd466f104","targetPort":"do"},{"sourceId":"437615fa-1359-9a4a-d438-18e0b6f9e548","sourcePort":"result","targetId":"a03806d7-0ae5-63af-605e-22d270794861","targetPort":"mounted"},{"sourceId":"3dc9e418-b63a-fb75-49c7-232e8891a438","sourcePort":"value","targetId":"2374149a-d8b0-9507-d6c5-0d7bc133f270","targetPort":"src"},{"sourceId":"0d183183-f593-d66f-71d5-d793067debba","sourcePort":"value","targetId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","targetPort":"popupParam-maskwidth"},{"sourceId":"c0681fba-d43f-c233-31e3-f48f22a148ba","sourcePort":"value","targetId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","targetPort":"popupParam-Maskheight"},{"sourceId":"798ac0f3-db43-1e16-9afc-9aeff7b21531","sourcePort":"onClick","targetId":"8d3d505c-f024-9a69-4854-7a74271b4b9f","targetPort":"open"},{"sourceId":"95ab55ea-6375-7d2a-fe64-e113282b6390","sourcePort":"onClick","targetId":"ebd67145-161c-8edc-4283-d8d07f46ecfd","targetPort":"show"},{"sourceId":"8d3d505c-f024-9a69-4854-7a74271b4b9f","sourcePort":"file","targetId":"2b253457-10a6-77f0-4727-1f3299887187","targetPort":"in-file"},{"sourceId":"2b253457-10a6-77f0-4727-1f3299887187","sourcePort":"out-imageUrl","targetId":"d9ab89bd-2cd5-f6c9-9254-7ccafb2431f6","targetPort":"src"},{"sourceId":"3dc9e418-b63a-fb75-49c7-232e8891a438","sourcePort":"value","targetId":"afc5944e-4d61-03a3-fb5d-ba7ffeb29983","targetPort":"in-blobUrl"}],"ports":[],"roots":["7c69981d-91c6-f89e-da62-2fe6aad803f5"]},{"name":"/#Image Cropper/Example Usage/Cropper Popup","nodes":[{"id":"a6259b81-4ab8-9ed7-b7b5-d7bfa66aeeb6","type":"Group","parameters":{"backgroundColor":"#FFFFFF99"},"ports":[],"children":[{"id":"df56c286-da0a-ab5e-941f-8a19e6e16da0","type":"Group","parameters":{"width":{"value":80,"unit":"%","isFixed":true},"height":{"value":80,"unit":"%","isFixed":true},"alignX":"center","alignY":"center","position":"absolute","maxWidth":{"value":600,"unit":"px"},"maxHeight":{"value":800,"unit":"px"},"minWidth":{"value":300,"unit":"px"},"minHeight":{"value":400,"unit":"px"},"borderStyle":"none","borderRadius":{"value":20,"unit":"px"},"paddingTop":{"value":20,"unit":"px"},"paddingLeft":{"value":20,"unit":"px"},"paddingRight":{"value":20,"unit":"px"},"paddingBottom":{"value":20,"unit":"px"},"backgroundColor":"#FFFFFF","sizeMode":"contentSize","boxShadowEnabled":true},"ports":[],"children":[{"id":"3b1ba8ba-dd8d-9fc1-6ffc-c6cbe64fa7b4","type":"Text","parameters":{"fontFamily":"fonts/Roboto/Roboto-Bold.ttf","text":"Select area of image.","alignX":"center","textAlignX":"center","marginBottom":{"value":20,"unit":"px"},"textStyle":"Label Medium"},"ports":[],"children":[]},{"id":"e2ec669b-4882-fc52-1497-6e074b645197","type":"/#Image Cropper/Image Cropper","parameters":{"Circular Mask":true,"Mask Color":"#FFFFFF42"},"ports":[],"children":[]},{"id":"d1837919-d6a3-1fe5-09ae-0c938b6029a8","type":"Group","parameters":{"flexDirection":"row","sizeMode":"contentHeight","marginBottom":{"value":20,"unit":"px"},"marginTop":{"value":25,"unit":"px"},"alignX":"center","justifyContent":"center","alignItems":"center"},"ports":[],"children":[{"id":"c6b9be04-7e79-daed-5ab8-c19b746e3672","type":"net.noodl.controls.button","variant":"Zoom Button","parameters":{"sizeMode":"explicit","width":{"value":30,"unit":"px"},"height":{"value":30,"unit":"px"},"borderRadius":{"value":30,"unit":"px"},"marginRight":{"value":20,"unit":"px"},"iconColor":"Black","backgroundColor":"transparent"},"stateParameters":{},"stateTransitions":{},"defaultStateTransitions":{},"ports":[],"children":[]},{"id":"a55fcdff-c8ae-4e47-6523-5ab010b966d7","type":"net.noodl.controls.button","variant":"Zoom Button","parameters":{"iconIconSource":{"class":"material-icons","code":"zoom_out"},"width":{"value":30,"unit":"px"},"height":{"value":30,"unit":"px"},"iconColor":"Black","backgroundColor":"transparent"},"ports":[],"children":[]}]},{"id":"f0119978-1c3a-f7d4-02b7-710ec5d461fb","type":"Group","parameters":{"sizeMode":"contentHeight","alignX":"right","flexDirection":"row"},"ports":[],"children":[{"id":"f6719a02-4522-4bf7-7b61-327c98b36292","type":"net.noodl.controls.button","parameters":{"alignY":"center","label":"Use this image","paddingLeft":{"value":10,"unit":"px"},"paddingRight":{"value":10,"unit":"px"},"alignX":"left","backgroundColor":"Black"},"ports":[],"children":[]},{"id":"7420fc3c-faae-32f7-5d87-1ae483875905","type":"net.noodl.controls.button","parameters":{"label":"Cancel","alignX":"right","backgroundColor":"#F53636"},"ports":[],"children":[]}]}]}]},{"id":"64fd4060-c819-c669-6980-84c9b4ae80c9","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"bc45ee6e-e0ce-4260-4574-3d5fff79af7b","type":"NavigationClosePopup","parameters":{"closeActions":"Cancel,Image Selected","results":"Image File,Image Url"},"ports":[],"children":[]}],"connections":[{"sourceId":"64fd4060-c819-c669-6980-84c9b4ae80c9","sourcePort":"File","targetId":"e2ec669b-4882-fc52-1497-6e074b645197","targetPort":"Image File"},{"sourceId":"c6b9be04-7e79-daed-5ab8-c19b746e3672","sourcePort":"onClick","targetId":"e2ec669b-4882-fc52-1497-6e074b645197","targetPort":"Zoom In"},{"sourceId":"a55fcdff-c8ae-4e47-6523-5ab010b966d7","sourcePort":"onClick","targetId":"e2ec669b-4882-fc52-1497-6e074b645197","targetPort":"Zoom Out"},{"sourceId":"e2ec669b-4882-fc52-1497-6e074b645197","sourcePort":"Cropped File","targetId":"bc45ee6e-e0ce-4260-4574-3d5fff79af7b","targetPort":"result-Image File"},{"sourceId":"f6719a02-4522-4bf7-7b61-327c98b36292","sourcePort":"onClick","targetId":"bc45ee6e-e0ce-4260-4574-3d5fff79af7b","targetPort":"closeAction-Image Selected"},{"sourceId":"7420fc3c-faae-32f7-5d87-1ae483875905","sourcePort":"onClick","targetId":"bc45ee6e-e0ce-4260-4574-3d5fff79af7b","targetPort":"closeAction-Cancel"},{"sourceId":"e2ec669b-4882-fc52-1497-6e074b645197","sourcePort":"Preview Url","targetId":"bc45ee6e-e0ce-4260-4574-3d5fff79af7b","targetPort":"result-Image Url"},{"sourceId":"64fd4060-c819-c669-6980-84c9b4ae80c9","sourcePort":"Maskheight","targetId":"e2ec669b-4882-fc52-1497-6e074b645197","targetPort":"Mask Ratio Height"},{"sourceId":"64fd4060-c819-c669-6980-84c9b4ae80c9","sourcePort":"maskwidth","targetId":"e2ec669b-4882-fc52-1497-6e074b645197","targetPort":"Mask Ratio Width"}],"ports":[{"name":"File","type":{"name":"*"},"group":"Image File","plug":"input","index":1},{"name":"File Name","type":"*","plug":"input","index":2},{"name":"Maskheight","type":"number","group":"Mask","plug":"input","index":3},{"name":"maskwidth","type":"number","group":"Mask","plug":"input","index":4}],"roots":["a6259b81-4ab8-9ed7-b7b5-d7bfa66aeeb6"],"metadata":{"canvasPos":{"x":590,"y":32}}},{"name":"/#Image Cropper/Image Cropper","nodes":[{"id":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"cff92163-b895-c1e6-c868-1d0655cf94b3","type":"Group","parameters":{"sizeMode":"explicit","position":"relative","alignY":"center","alignX":"center","zIndex":2,"backgroundColor":"#FFFFFF","borderRadius":{"value":8,"unit":"px"}},"ports":[],"children":[{"id":"3d450c32-733e-14cb-25ac-2709e06821f6","type":"Group","parameters":{"sizeMode":"explicit","clip":true},"ports":[],"children":[{"id":"d1d80769-9593-5c81-d1d8-88639ecef056","type":"Group","parameters":{"width":{"value":100,"unit":"px"},"height":{"value":100,"unit":"px"},"alignY":"center","alignX":"center"},"ports":[],"children":[{"id":"510e460e-7d91-ed16-18b5-f96c7dfad205","type":"/#Image Cropper/Internal Components/Panning Control","parameters":{"Enable Clip":false,"Min Zoom Level":0.2},"ports":[],"children":[]}]},{"id":"d3b25396-952f-1996-fa83-ea5302d27745","type":"Group","parameters":{"position":"absolute","backgroundColor":"#C6C6C6","width":{"value":100,"unit":"px"},"height":{"value":100,"unit":"px"},"transformOriginX":{"value":0,"unit":"%"},"transformOriginY":{"value":0,"unit":"%"},"borderStyle":"solid","borderWidth":{"value":4,"unit":"px"},"alignY":"center","alignX":"center","pointerEventsMode":"explicit","pointerEventsEnabled":false},"ports":[],"children":[]}]}]},{"id":"53f78abe-e45d-8cad-3d5e-438f53dbb007","type":"Javascript2","parameters":{"code":"var inited = false;\r\nvar reader;\r\nvar img;\r\nvar imageWidth, imageHeight;\r\nvar canvas;\r\nvar maskWidth, maskHeight;\r\n\r\n\r\nScript.Inputs = {\r\n    ImageFile:'*'\r\n}\r\n\r\nScript.Outputs = {\r\n    CropFile:'cloudfile'\r\n}\r\n\r\nfunction calculateScale ( arenaDims, imageDims) {\r\n    let wr = arenaDims.w / imageDims.w;\r\n    let hr = arenaDims.h / imageDims.h;\r\n    if (wr < hr) {\r\n        return wr;\r\n    }\r\n    else {\r\n        return hr;\r\n    }\r\n}\r\n\r\nScript.Setters.ArenaWidth = function () {\r\n    refreshDimensions ();\r\n}\r\n\r\nScript.Setters.ArenaHeight = function () {\r\n    refreshDimensions ();\r\n}\r\n\r\nfunction refreshDimensions () {\r\n    if (inited === false || Script.Inputs.ArenaWidth === undefined || Script.Inputs.ArenaHeight === undefined) {\r\n        return false;\r\n    }\r\n    else {\r\n\r\n        // figure out scale factor\r\n        scaleFactor = calculateScale (\r\n            {w:Script.Inputs.ArenaWidth, h:Script.Inputs.ArenaHeight},\r\n            {w:imageWidth, h:imageHeight});\r\n        \r\n        Script.Outputs.InitialZoomLevel = scaleFactor;\r\n    \r\n        // calculate the relative size of the mask contra image\r\n        let wr = Script.Inputs.MaskRatioWidth / imageWidth;\r\n        let hr = Script.Inputs.MaskRatioHeight / imageHeight;\r\n    \r\n        if (wr === hr) {\r\n            maskWidth = imageWidth;\r\n            maskHeight = imageHeight;\r\n        }\r\n        else if (wr > hr) {\r\n            // width is most similar, align width\r\n            let hx = Script.Inputs.MaskRatioHeight * imageWidth / Script.Inputs.MaskRatioWidth;\r\n            maskWidth = imageWidth;\r\n            maskHeight = hx;\r\n        }\r\n        else {\r\n            let wx = Script.Inputs.MaskRatioWidth * imageHeight / Script.Inputs.MaskRatioHeight;\r\n            maskWidth = wx;\r\n            maskHeight = imageHeight;\r\n        }\r\n        Script.Outputs.MaskWidth = maskWidth * scaleFactor;\r\n        Script.Outputs.MaskHeight = maskHeight * scaleFactor;\r\n        Script.Outputs.InitialZoomLevel = scaleFactor;\r\n        return true;\r\n    }\r\n}\r\n\r\nScript.Signals.Init = function () {\r\n    inited = false;\r\n    reader = new FileReader();\r\n    reader.readAsDataURL(Node.Inputs.ImageFile);\r\n    Node.Outputs.ImageUrl = URL.createObjectURL(Node.Inputs.ImageFile);\r\n\r\n    reader.onload = function (e) {\r\n        img = document.createElement(\"img\");\r\n        img.src = e.target.result;\r\n        img.onload = function() {\r\n            imageWidth = img.width;\r\n            imageHeight = img.height;\r\n            inited = true;\r\n            refreshDimensions ();\r\n        }\r\n    };\r\n}\r\n\r\nScript.Signals.Crop = function () {\r\n    canvas = document.createElement(\"canvas\");\r\n    // figure out the longest dimension and scale if necessary\r\n    let targetImageScaleFactor = 1;\r\n    \r\n    if (maskWidth > maskHeight) {\r\n        if (maskWidth > Script.Inputs.MaxResolutions) {\r\n            targetImageScaleFactor = Script.Inputs.MaxResolutions / maskWidth;\r\n        }\r\n    }\r\n    else {\r\n        if (maskHeight > Script.Inputs.MaxResolutions) {\r\n            targetImageScaleFactor = Script.Inputs.MaxResolutions / maskHeight;\r\n        }\r\n    }\r\n    \r\n    \r\n    // scale up image space coords of the mask\r\n    let sx = Script.Inputs.CropXPos === undefined?0:Math.floor (Script.Inputs.CropXPos);\r\n    let sy = Script.Inputs.CropYPos === undefined?0:Math.floor (Script.Inputs.CropYPos);\r\n    let sWidth = Math.floor (Script.Inputs.CropWidth);\r\n    let sHeight = Math.floor (Script.Inputs.CropHeight);\r\n    let dWidth = Math.floor (targetImageScaleFactor*maskWidth);\r\n    let dHeight = Math.floor (targetImageScaleFactor*maskHeight);\r\n    canvas.width = dWidth;\r\n    canvas.height = dHeight;\r\n    \r\n    let ctx = canvas.getContext(\"2d\");\r\n    ctx.fillStyle='white';\r\n    ctx.fillRect(0,0,dWidth,dHeight)\r\n    ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, dWidth, dHeight);\r\n    let filename =  Script.Inputs.FileName === undefined?\"img\"+Math.round (Math.random()*1000000):Script.Inputs.FileName;\r\n    let dataurl = canvas.toBlob(blob => {\r\n        const file = new File([blob], filename);\r\n        Script.Outputs.CropFile = file;\r\n        Script.Outputs.CropFileSize = Math.round(file.size);\r\n        \r\n        Script.Outputs.CropFileUrl = URL.createObjectURL(file);\r\n        \r\n        Script.Outputs.CropDone();\r\n    },'image/jpeg');   \r\n}","scriptOutputs":[{"id":"t2fy","label":"ImageUrl"},{"id":"ylf7","label":"InitDone"},{"id":"viii","label":"InitialZoomLevel"},{"id":"0rld","label":"MaskWidth"},{"id":"xxhe","label":"MaskHeight"},{"id":"xtw8","label":"CropFileSize"},{"id":"f3qb","label":"CropFileUrl"},{"id":"iwk2","label":"CropDone"}],"outtype-InitDone":"signal","scriptInputs":[{"id":"e2rq","label":"ArenaWidth"},{"id":"10p7","label":"ArenaHeight"},{"id":"t05c","label":"MaskRatioWidth"},{"id":"mi89","label":"MaskRatioHeight"},{"id":"odly","label":"CropXPos"},{"id":"7iel","label":"CropYPos"},{"id":"4h86","label":"CropWidth"},{"id":"9tmb","label":"CropHeight"},{"id":"kj7f","label":"MaxResolutions"},{"id":"a93j","label":"FileName"}],"intype-ArenaWidth":"number","outtype-InitialZoomLevel":"number","intype-ArenaHeight":"number","intype-MaskRatioWidth":"number","intype-MaskRatioHeight":"number","outtype-MaskWidth":"number","outtype-MaskHeight":"number","intype-CropXPos":"number","intype-CropYPos":"number","intype-CropWidth":"number","intype-CropHeight":"number","intype-MaxResolution":"number","intype-MaxResolutions":"number","outtype-CroppedFileSize":"number","outtype-CropFileSize":"number","outtype-CropDone":"signal","MaxResolutions":240},"ports":[{"name":"outtype-ImageUrl","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"t2fy","index":5},{"name":"ImageUrl","plug":"output","type":"*","group":"Outputs","index":6},{"name":"outtype-InitDone","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"ylf7","index":7},{"name":"InitDone","plug":"output","type":"signal","group":"Outputs","index":8},{"name":"outtype-InitialZoomLevel","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"viii","index":9},{"name":"InitialZoomLevel","plug":"output","type":"number","group":"Outputs","index":10},{"name":"outtype-MaskWidth","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"0rld","index":11},{"name":"MaskWidth","plug":"output","type":"number","group":"Outputs","index":12},{"name":"outtype-MaskHeight","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"xxhe","index":13},{"name":"MaskHeight","plug":"output","type":"number","group":"Outputs","index":14},{"name":"outtype-CropFileSize","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"xtw8","index":15},{"name":"CropFileSize","plug":"output","type":"number","group":"Outputs","index":16},{"name":"outtype-CropFileUrl","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"f3qb","index":17},{"name":"CropFileUrl","plug":"output","type":"*","group":"Outputs","index":18},{"name":"outtype-CropDone","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"iwk2","index":19},{"name":"CropDone","plug":"output","type":"signal","group":"Outputs","index":20},{"name":"intype-ArenaWidth","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"e2rq","index":21},{"name":"ArenaWidth","plug":"input","type":"number","group":"Inputs","index":22},{"name":"intype-ArenaHeight","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"10p7","index":23},{"name":"ArenaHeight","plug":"input","type":"number","group":"Inputs","index":24},{"name":"intype-MaskRatioWidth","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"t05c","index":25},{"name":"MaskRatioWidth","plug":"input","type":"number","group":"Inputs","index":26},{"name":"intype-MaskRatioHeight","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"mi89","index":27},{"name":"MaskRatioHeight","plug":"input","type":"number","group":"Inputs","index":28},{"name":"intype-CropXPos","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"odly","index":29},{"name":"CropXPos","plug":"input","type":"number","group":"Inputs","index":30},{"name":"intype-CropYPos","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"7iel","index":31},{"name":"CropYPos","plug":"input","type":"number","group":"Inputs","index":32},{"name":"intype-CropWidth","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"4h86","index":33},{"name":"CropWidth","plug":"input","type":"number","group":"Inputs","index":34},{"name":"intype-CropHeight","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"9tmb","index":35},{"name":"CropHeight","plug":"input","type":"number","group":"Inputs","index":36},{"name":"intype-MaxResolutions","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"kj7f","index":37},{"name":"MaxResolutions","plug":"input","type":"number","group":"Inputs","index":38},{"name":"intype-FileName","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"a93j","index":39},{"name":"FileName","plug":"input","type":"string","group":"Inputs","index":40},{"name":"ImageFile","plug":"input","type":{"name":"*"},"group":"Inputs","index":41},{"name":"Init","plug":"input","type":{"name":"signal"},"group":"Inputs","index":42},{"name":"Crop","plug":"input","type":{"name":"signal"},"group":"Inputs","index":43},{"name":"CropFile","type":{"name":"cloudfile"},"plug":"output","group":"Outputs","index":44}],"children":[]},{"id":"b255c39f-9125-70d4-039d-f6aa52db6b94","type":"Expression","parameters":{"expression":"circularEnabled?w/2:0"},"ports":[],"children":[]},{"id":"51cc191f-3427-a6c3-fe51-aff2a2c7fe9b","type":"Boolean","parameters":{},"ports":[],"children":[]},{"id":"5fddbb41-e72f-4495-e2c9-5326def16472","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"852cf42c-0a16-985f-0168-75c51eafb3ea","type":"Timer","parameters":{"duration":300},"ports":[],"children":[]},{"id":"1305f36b-70d7-f960-5889-fc91c9500d4b","type":"Color","parameters":{"value":"#0000004C"},"ports":[],"children":[]},{"id":"0ce0164f-19ee-9240-534a-bbe3f6191970","type":"Number","parameters":{"value":2},"ports":[],"children":[]}],"connections":[{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Mounted","targetId":"cff92163-b895-c1e6-c868-1d0655cf94b3","targetPort":"mounted"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Image File","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"ImageFile"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"ImageUrl","targetId":"510e460e-7d91-ed16-18b5-f96c7dfad205","targetPort":"Image"},{"sourceId":"3d450c32-733e-14cb-25ac-2709e06821f6","sourcePort":"boundingWidth","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"ArenaWidth"},{"sourceId":"3d450c32-733e-14cb-25ac-2709e06821f6","sourcePort":"boundingHeight","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"ArenaHeight"},{"sourceId":"3d450c32-733e-14cb-25ac-2709e06821f6","sourcePort":"didMount","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"Init"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Mask Ratio Width","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"MaskRatioWidth"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Mask Ratio Height","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"MaskRatioHeight"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"MaskWidth","targetId":"d1d80769-9593-5c81-d1d8-88639ecef056","targetPort":"width"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"MaskHeight","targetId":"d1d80769-9593-5c81-d1d8-88639ecef056","targetPort":"height"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"MaskWidth","targetId":"d3b25396-952f-1996-fa83-ea5302d27745","targetPort":"width"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"MaskHeight","targetId":"d3b25396-952f-1996-fa83-ea5302d27745","targetPort":"height"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"InitialZoomLevel","targetId":"510e460e-7d91-ed16-18b5-f96c7dfad205","targetPort":"Zoom Level"},{"sourceId":"510e460e-7d91-ed16-18b5-f96c7dfad205","sourcePort":"X pos","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"CropXPos"},{"sourceId":"510e460e-7d91-ed16-18b5-f96c7dfad205","sourcePort":"Y pos","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"CropYPos"},{"sourceId":"510e460e-7d91-ed16-18b5-f96c7dfad205","sourcePort":"Height","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"CropHeight"},{"sourceId":"510e460e-7d91-ed16-18b5-f96c7dfad205","sourcePort":"Width","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"CropWidth"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"MaskWidth","targetId":"b255c39f-9125-70d4-039d-f6aa52db6b94","targetPort":"w"},{"sourceId":"b255c39f-9125-70d4-039d-f6aa52db6b94","sourcePort":"result","targetId":"d3b25396-952f-1996-fa83-ea5302d27745","targetPort":"borderRadius"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Circular Mask","targetId":"51cc191f-3427-a6c3-fe51-aff2a2c7fe9b","targetPort":"value"},{"sourceId":"51cc191f-3427-a6c3-fe51-aff2a2c7fe9b","sourcePort":"savedValue","targetId":"b255c39f-9125-70d4-039d-f6aa52db6b94","targetPort":"circularEnabled"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Target Resolution","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"MaxResolutions"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"CropFile","targetId":"5fddbb41-e72f-4495-e2c9-5326def16472","targetPort":"Cropped File"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"CropFileSize","targetId":"5fddbb41-e72f-4495-e2c9-5326def16472","targetPort":"Cropped File Size"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"CropFileUrl","targetId":"5fddbb41-e72f-4495-e2c9-5326def16472","targetPort":"Preview Url"},{"sourceId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","sourcePort":"CropDone","targetId":"5fddbb41-e72f-4495-e2c9-5326def16472","targetPort":"New Area Selected"},{"sourceId":"510e460e-7d91-ed16-18b5-f96c7dfad205","sourcePort":"View Updated","targetId":"852cf42c-0a16-985f-0168-75c51eafb3ea","targetPort":"start"},{"sourceId":"852cf42c-0a16-985f-0168-75c51eafb3ea","sourcePort":"timerFinished","targetId":"53f78abe-e45d-8cad-3d5e-438f53dbb007","targetPort":"Crop"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Zoom In","targetId":"510e460e-7d91-ed16-18b5-f96c7dfad205","targetPort":"Zoom In"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Zoom Out","targetId":"510e460e-7d91-ed16-18b5-f96c7dfad205","targetPort":"Zoom Out"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Mask Color","targetId":"1305f36b-70d7-f960-5889-fc91c9500d4b","targetPort":"value"},{"sourceId":"1305f36b-70d7-f960-5889-fc91c9500d4b","sourcePort":"savedValue","targetId":"d3b25396-952f-1996-fa83-ea5302d27745","targetPort":"backgroundColor"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Mask Border Style","targetId":"d3b25396-952f-1996-fa83-ea5302d27745","targetPort":"borderStyle"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Mask Border Color","targetId":"d3b25396-952f-1996-fa83-ea5302d27745","targetPort":"borderColor"},{"sourceId":"d9f5248b-c401-db5a-9e24-e4abf64c4df5","sourcePort":"Mask Border Width","targetId":"0ce0164f-19ee-9240-534a-bbe3f6191970","targetPort":"value"},{"sourceId":"0ce0164f-19ee-9240-534a-bbe3f6191970","sourcePort":"savedValue","targetId":"d3b25396-952f-1996-fa83-ea5302d27745","targetPort":"borderWidth"}],"ports":[{"name":"New Area Selected","type":"signal","plug":"output","index":0},{"name":"Image File","type":{"name":"*"},"group":"Image File","plug":"input","index":0},{"name":"Cropped File","type":{"name":"cloudfile"},"plug":"output","index":1},{"name":"Circular Mask","type":{"name":"boolean"},"default":false,"group":"Mask","plug":"input","index":1},{"name":"Cropped File Size","type":"number","plug":"output","index":2},{"name":"Mask Ratio Height","type":"number","group":"Mask","plug":"input","index":2},{"name":"Preview Url","type":"*","plug":"output","index":3},{"name":"Mask Ratio Width","type":"number","group":"Mask","plug":"input","index":3},{"name":"Mounted","type":"boolean","default":true,"group":"Other","plug":"input","index":4},{"name":"Target Resolution","type":"number","default":240,"group":"Other","plug":"input","index":5},{"name":"Zoom In","type":{"name":"signal"},"group":"Zooming","plug":"input","index":6},{"name":"Zoom Out","type":{"name":"signal"},"group":"Zooming","plug":"input","index":7},{"name":"Mask Color","type":{"name":"color"},"default":"#0000004C","group":"Mask Styling","plug":"input","index":8},{"name":"Mask Border Style","type":{"name":"enum","enums":[{"label":"None","value":"none"},{"label":"Solid","value":"solid"},{"label":"Dotted","value":"dotted"},{"label":"Dashed","value":"dashed"}]},"default":"solid","group":"Mask Styling","plug":"input","index":9},{"name":"Mask Border Color","type":"color","default":"#000000","group":"Mask Styling","plug":"input","index":10},{"name":"Mask Border Width","type":{"name":"number"},"default":2,"group":"Mask Styling","plug":"input","index":11}],"roots":["cff92163-b895-c1e6-c868-1d0655cf94b3"],"metadata":{"canvasPos":{"x":2939,"y":0}}},{"name":"/#Image Cropper/Internal Components/Panning Control","nodes":[{"id":"c2ed26c6-e7c0-c109-e83f-3e514b4c4b46","type":"Group","parameters":{},"ports":[],"children":[{"id":"a05ac464-5256-9567-e2b4-db4a735b06a8","type":"Image","parameters":{"position":"absolute","sizeMode":"contentHeight","width":{"value":100,"unit":"px"},"alignY":"top","alignX":"left"},"ports":[],"children":[]},{"id":"58e9a4a0-8f91-170e-a4d4-1aef7426cd65","type":"Drag","parameters":{"axis":"both","useParentBounds":false},"ports":[],"children":[{"id":"33cf2063-d714-c2d0-afe7-01351ffa43b3","type":"Group","parameters":{"width":{"value":1000,"unit":"%","isFixed":true},"height":{"value":1000,"unit":"%","isFixed":true},"alignX":"center","alignY":"center","position":"absolute"},"ports":[],"children":[]}]}]},{"id":"da291aae-3607-3b37-87dd-9348b957f2cb","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"8c71216d-4e6f-5604-158e-a09d87aedfb2","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"3747f096-2869-6950-7ad7-979ed3ce41cd","type":"Javascript2","parameters":{"scriptInputs":[{"id":"6zt5","label":"ConstraintToParent"},{"id":"mcom","label":"ContainerWidth"},{"id":"jfkw","label":"ContainerHeight"},{"id":"hd6x","label":"SuggestedZoomLevel"},{"id":"w3tk","label":"MinZoomLevel"},{"id":"g2ry","label":"MaxZoomLevel"},{"id":"lhxe","label":"EnableScrollWheelZooming"},{"id":"4po2","label":"DeltaX"},{"id":"y3cd","label":"DeltaY"},{"id":"db2j","label":"EnablePinchZooming"}],"code":"var nativeImageHeight;\r\nvar nativeImageWidth;\r\nvar zoomLevel = 1;\r\nvar inited = false;\r\nvar imageXPos;\r\nvar imageYPos;\r\nvar delayedZoom = -1;\r\n\r\nScript.Inputs = {\r\n    ImageNode:'*',\r\n    DragNode:'*'\r\n}\r\n\r\n// pinch zoom code\r\n\r\nfunction addPinchZoomListeners () {\r\n    if (Script.Inputs.DragNode !== undefined) {\r\n        Script.Inputs.DragNode.getDOMElement().addEventListener ('pointerdown', pzPointerDown);\r\n        Script.Inputs.DragNode.getDOMElement().addEventListener ('pointermove', pzPointerMove);\r\n        Script.Inputs.DragNode.getDOMElement().addEventListener ('pointerup', pzPointerUp);\r\n    }\r\n}\r\n\r\nfunction removePinchZoomListeners () {\r\n    if (Script.Inputs.DragNode !== undefined) {\r\n        Script.Inputs.DragNode.getDOMElement().removeEventListener ('pointerdown', pzPointerDown);\r\n        Script.Inputs.DragNode.getDOMElement().removeEventListener ('pointermove', pzPointerMove);\r\n        Script.Inputs.DragNode.getDOMElement().removeEventListener ('pointerup', pzPointerUp);\r\n    }\r\n}\r\n\r\nvar pzEventCache = [];\r\nvar pzPrevDiff = -1;\r\n\r\nfunction pzPointerDown (ev) {\r\n    pzEventCache.push (ev);\r\n}\r\n\r\nfunction pzPointerUp (ev) {\r\n    for (let i = 0; i < pzEventCache.length; i++) {\r\n        let e = pzEventCache[i];\r\n        if (e.pointerId === ev.pointerId) {\r\n            pzEventCache.splice(i, 1);\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (pzEventCache.length < 2) {\r\n        pzPrevDiff = -1;\r\n    }\r\n}\r\n\r\nfunction pzPointerMove (ev) {\r\n\r\n    for (let i = 0; i < pzEventCache.length;i++) {\r\n        let e = pzEventCache[i];\r\n        if (e.pointerId === ev.pointerId) {\r\n            pzEventCache[i] = ev;\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (pzEventCache.length === 2) {\r\n        let xDiff = Math.abs (pzEventCache[0].clientX-pzEventCache[1].clientX);\r\n        if (pzPrevDiff > 0) {\r\n            if (xDiff > pzPrevDiff) {\r\n                zoomInSmall();\r\n            }\r\n            else if (xDiff < pzPrevDiff) {\r\n                zoomOutSmall();\r\n            }\r\n        }\r\n        pzPrevDiff = xDiff;\r\n    }\r\n}\r\n\r\nScript.Signals.CancelMultiTouch = function () {\r\n    if (Script.Signals.EnablePinchZooming) {\r\n        pzEventCache = [];\r\n    }\r\n}\r\n\r\nScript.Signals.Init = function () {\r\n    if (Script.Inputs.ImageNode !== undefined) {\r\n        nativeImageWidth = Script.Inputs.ImageNode.getDOMElement().naturalWidth;\r\n        nativeImageHeight = Script.Inputs.ImageNode.getDOMElement().naturalHeight;\r\n\r\n        if (Script.Inputs.EnablePinchZooming) {\r\n            addPinchZoomListeners ();     \r\n        }\r\n    }\r\n    \r\n    imageXPos = 0;\r\n    imageYPos = 0;\r\n    inited = true;\r\n    if (delayedZoom !== -1) {\r\n        tryZoom (delayedZoom);\r\n        delayedZoom = -1;\r\n    }\r\n    else {\r\n        refreshView();\r\n    }\r\n    \r\n}\r\n\r\nfunction zoomInSmall () {\r\n    tryZoom (zoomLevel * 1.01);\r\n}\r\n\r\nfunction zoomOutSmall () {\r\n    tryZoom (zoomLevel * 0.99);\r\n}\r\n\r\nfunction zoomIn () {\r\n    tryZoom (zoomLevel * 1.05);\r\n}\r\n\r\nfunction zoomOut () {\r\n    tryZoom (zoomLevel * 0.95);\r\n}\r\n\r\nScript.Signals.ZoomIn = function () {\r\n    zoomIn();\r\n}\r\n\r\nScript.Signals.ZoomOut = function () {\r\n    zoomOut();\r\n}\r\n\r\nfunction tryZoom (value) {\r\n    if (!inited) {\r\n        return;\r\n    }\r\n    let oldZoomLevel = zoomLevel;\r\n    if (value < Script.Inputs.MinZoomLevel) {\r\n        // cant zoom out more\r\n        zoomLevel = Script.Inputs.MinZoomLevel;\r\n    }\r\n    if (value > Script.Inputs.MaxZoomLevel) {\r\n        // cant zoom out more\r\n        zoomLevel = Script.Inputs.MaxZoomLevel ;\r\n    }\r\n    if (Script.Inputs.ConstraintToParent) {\r\n        zoomLevel = value;\r\n        if (zoomLevel * nativeImageWidth < Script.Inputs.ContainerWidth) {\r\n            zoomLevel = Script.Inputs.ContainerWidth / nativeImageWidth;\r\n        }\r\n        if (zoomLevel * nativeImageHeight < Script.Inputs.ContainerHeight) {\r\n            zoomLevel = Script.Inputs.ContainerHeight / nativeImageHeight;\r\n        }\r\n        // check if any of the edges are outside the container\r\n\r\n        let lp = imageXPos * zoomLevel - nativeImageWidth * zoomLevel/2 + Script.Inputs.ContainerWidth/2;\r\n        if (lp > 0) {\r\n            imageXPos -= lp / zoomLevel;\r\n        }\r\n\r\n        let tp = imageYPos * zoomLevel - nativeImageHeight * zoomLevel/2 + Script.Inputs.ContainerHeight/2;\r\n        if (tp > 0) {\r\n            imageYPos -= tp / zoomLevel;\r\n        }\r\n\r\n        let rp = imageXPos * zoomLevel + nativeImageWidth * zoomLevel/2 - Script.Inputs.ContainerWidth/2;\r\n        if (rp < 0) {\r\n            imageXPos -= rp / zoomLevel;\r\n        }\r\n        let bp = imageYPos * zoomLevel + nativeImageHeight * zoomLevel/2 - Script.Inputs.ContainerHeight/2;\r\n        if (bp < 0) {\r\n            imageYPos -= bp / zoomLevel;\r\n        }\r\n    }\r\n    else {\r\n        zoomLevel = value;\r\n    }\r\n\r\n    if (zoomLevel !== oldZoomLevel) {\r\n        refreshView();\r\n    }\r\n}\r\n\r\nScript.Setters.SuggestedZoomLevel = function (value) {\r\n    if (!inited) {\r\n        delayedZoom = value;\r\n    }\r\n    else {\r\n        tryZoom (value);\r\n    }\r\n    \r\n}\r\n\r\n\r\nScript.Setters.DeltaX = function (value) {\r\n    if (!inited) {\r\n        return;\r\n    }\r\n    let oldPos = imageXPos;\r\n    imageXPos += value/zoomLevel;\r\n    if (Script.Inputs.ConstraintToParent) {\r\n        let leftLimit = -(nativeImageWidth - Script.Inputs.ContainerWidth/zoomLevel)/2;\r\n        let rightLimit = (nativeImageWidth - Script.Inputs.ContainerWidth/zoomLevel)/2;\r\n        \r\n        if (imageXPos < leftLimit) {\r\n            imageXPos = leftLimit;\r\n        }\r\n        else if (imageXPos > rightLimit) {\r\n            imageXPos = rightLimit;\r\n        }\r\n    }\r\n    if (oldPos !== imageXPos) {\r\n        refreshView();\r\n    }\r\n    \r\n}\r\n\r\nScript.Setters.DeltaY = function (value) {\r\n    if (!inited) {\r\n        return;\r\n    }\r\n    let oldPos = imageYPos;\r\n    imageYPos += value/zoomLevel;\r\n    if (Script.Inputs.ConstraintToParent) {\r\n        //let scaledImageHeight = nativeImageHeight * zoomLevel;\r\n        let topLimit = -(nativeImageHeight - Script.Inputs.ContainerHeight/zoomLevel)/2;\r\n        let bottomLimit = (nativeImageHeight - Script.Inputs.ContainerHeight/zoomLevel)/2; \r\n        \r\n        if (imageYPos < topLimit) {\r\n            imageYPos = topLimit;\r\n        }\r\n        else if (imageYPos > bottomLimit) {\r\n            imageYPos = bottomLimit;\r\n        }\r\n    }\r\n    if (oldPos !== imageYPos) {\r\n        refreshView();\r\n    }\r\n    \r\n}\r\n\r\nScript.Setters.ContainerWidth = function (value) {\r\n    refreshView();\r\n}\r\n\r\nScript.Setters.ContainerHeight = function (value) {\r\n    refreshView();\r\n}\r\n\r\nfunction scrollWheelListener (event) {\r\n    let delta = event.deltaY;\r\n    if (delta < 0) {\r\n        zoomIn();\r\n    }\r\n    else {\r\n        zoomOut();\r\n    }\r\n}\r\n\r\nScript.Setters.EnableScrollWheelZooming = function (value) {\r\n    if (value === true) {\r\n        window.addEventListener ('wheel', scrollWheelListener);\r\n    }\r\n    else {\r\n        window.removeEventListener ('wheel', scrollWheelListener);\r\n    }\r\n}\r\n\r\n\r\n\r\nScript.Setters.EnablePinchZooming = function (value) {\r\n    if (value === true) {\r\n        if (inited === true) {\r\n            addPinchZoomListeners ();    \r\n        }\r\n    }\r\n    if (value === false) {\r\n        if (inited === true) {\r\n            removePinchZoomListeners ();\r\n        }\r\n    }\r\n}\r\n\r\nfunction refreshView () {\r\n    if (nativeImageHeight !== undefined &&\r\n    nativeImageWidth !== undefined &&\r\n    Script.Inputs.ContainerWidth !== undefined && Script.Inputs.ContainerHeight !== undefined) {        \r\n       \r\n        let scaledImageWidth = nativeImageWidth * zoomLevel;\r\n        let scaledImageHeight = nativeImageHeight * zoomLevel;\r\n        \r\n        Script.Outputs.ImageXpos = imageXPos * zoomLevel + Script.Inputs.ContainerWidth/2 - scaledImageWidth/2;\r\n        Script.Outputs.ImageYpos = imageYPos * zoomLevel + Script.Inputs.ContainerHeight/2 - scaledImageHeight/2;\r\n        Script.Outputs.ImageWidth = zoomLevel * nativeImageWidth;\r\n\r\n        // calculate visible area\r\n        let visibleX = (nativeImageWidth - Script.Inputs.ContainerWidth/zoomLevel)/2 - imageXPos;///zoomLevel + nativeImageWidth/2;\r\n        let visibleY = (nativeImageHeight - Script.Inputs.ContainerHeight/zoomLevel)/2 - imageYPos;\r\n        Script.Outputs.VisibleXPos = visibleX;\r\n        Script.Outputs.VisibleYPos = visibleY;\r\n        let visibleWidth = nativeImageWidth * ((Script.Inputs.ContainerWidth/zoomLevel) / nativeImageWidth);\r\n        let visibleHeight = nativeImageHeight * ((Script.Inputs.ContainerHeight/zoomLevel) / nativeImageHeight);\r\n        Script.Outputs.VisibleWidth = visibleWidth;\r\n        Script.Outputs.VisibleHeight = visibleHeight;\r\n        Script.Outputs.ViewUpdated();\r\n        \r\n    }\r\n}\r\n\r\nScript.OnDestroy = function () {\r\n    if (Script.Inputs.EnableScrollWheelZooming === true) {\r\n        window.removeEventListener ('wheel', scrollWheelListener);   \r\n    }\r\n    /*if (Script.Inputs.EnablePinchZooming === true) {\r\n        removePinchZoomListeners ();\r\n    }*/\r\n}","intype-ConstraintToParent":"boolean","intype-ContainerWidth":"number","scriptOutputs":[{"id":"s6nr","label":"ImageXpos"},{"id":"n1uo","label":"ImageYpos"},{"id":"vv1m","label":"ViewUpdated"},{"id":"lz55","label":"VisibleXPos"},{"id":"n7qf","label":"VisibleYPos"},{"id":"kqeh","label":"VisibleWidth"},{"id":"ufl0","label":"VisibleHeight"}],"outtype-ContainerHeight":"number","intype-ContainerHeight":"number","intype-Xdrag":"number","intype-Ydrag":"number","intype-ZoomLevel":"number","intype-SuggestedZoomLevel":"number","intype-MinZoomLevel":"number","intype-MaxZoomLevel":"number","outtype-ImageXpos":"number","outtype-ImageYpos":"number","outtype-ViewUpdated":"signal","intype-EnableScrollWheelZooming":"boolean","ConstraintToParent":true,"MinZoomLevel":0.5,"MaxZoomLevel":2,"EnableScrollWheelZooming":true,"intype-DeltaX":"number","intype-DeltaY":"number","outtype-VisibleXPos":"number","outtype-VisibleYPos":"number","outtype-VisibleWidth":"number","outtype-VisibleHeight":"number","intype-EnablePinchZooming":"boolean","EnablePinchZooming":true},"ports":[{"name":"outtype-ImageXpos","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"s6nr","index":5},{"name":"ImageXpos","plug":"output","type":"number","group":"Outputs","index":6},{"name":"outtype-ImageYpos","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"n1uo","index":7},{"name":"ImageYpos","plug":"output","type":"number","group":"Outputs","index":8},{"name":"outtype-ViewUpdated","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"vv1m","index":9},{"name":"ViewUpdated","plug":"output","type":"signal","group":"Outputs","index":10},{"name":"outtype-VisibleXPos","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"lz55","index":11},{"name":"VisibleXPos","plug":"output","type":"number","group":"Outputs","index":12},{"name":"outtype-VisibleYPos","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"n7qf","index":13},{"name":"VisibleYPos","plug":"output","type":"number","group":"Outputs","index":14},{"name":"outtype-VisibleWidth","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"kqeh","index":15},{"name":"VisibleWidth","plug":"output","type":"number","group":"Outputs","index":16},{"name":"outtype-VisibleHeight","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"ufl0","index":17},{"name":"VisibleHeight","plug":"output","type":"number","group":"Outputs","index":18},{"name":"intype-ConstraintToParent","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"6zt5","index":19},{"name":"ConstraintToParent","plug":"input","type":"boolean","group":"Inputs","index":20},{"name":"intype-ContainerWidth","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"mcom","index":21},{"name":"ContainerWidth","plug":"input","type":"number","group":"Inputs","index":22},{"name":"intype-ContainerHeight","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"jfkw","index":23},{"name":"ContainerHeight","plug":"input","type":"number","group":"Inputs","index":24},{"name":"intype-SuggestedZoomLevel","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"hd6x","index":25},{"name":"SuggestedZoomLevel","plug":"input","type":"number","group":"Inputs","index":26},{"name":"intype-MinZoomLevel","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"w3tk","index":27},{"name":"MinZoomLevel","plug":"input","type":"number","group":"Inputs","index":28},{"name":"intype-MaxZoomLevel","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"g2ry","index":29},{"name":"MaxZoomLevel","plug":"input","type":"number","group":"Inputs","index":30},{"name":"intype-EnableScrollWheelZooming","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"lhxe","index":31},{"name":"EnableScrollWheelZooming","plug":"input","type":"boolean","group":"Inputs","index":32},{"name":"intype-DeltaX","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"4po2","index":33},{"name":"DeltaX","plug":"input","type":"number","group":"Inputs","index":34},{"name":"intype-DeltaY","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"y3cd","index":35},{"name":"DeltaY","plug":"input","type":"number","group":"Inputs","index":36},{"name":"intype-EnablePinchZooming","displayName":"Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"array","label":"Array"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"db2j","index":37},{"name":"EnablePinchZooming","plug":"input","type":"boolean","group":"Inputs","index":38},{"name":"ImageNode","plug":"input","type":{"name":"*"},"group":"Inputs","index":39},{"name":"DragNode","plug":"input","type":{"name":"*"},"group":"Inputs","index":40},{"name":"CancelMultiTouch","plug":"input","type":{"name":"signal"},"group":"Inputs","index":41},{"name":"Init","plug":"input","type":{"name":"signal"},"group":"Inputs","index":42},{"name":"ZoomIn","plug":"input","type":{"name":"signal"},"group":"Inputs","index":43},{"name":"ZoomOut","plug":"input","type":{"name":"signal"},"group":"Inputs","index":44},{"name":"ImageWidth","displayName":"ImageWidth","plug":"output","type":"*","group":"Outputs","index":45}],"children":[]}],"connections":[{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Image","targetId":"a05ac464-5256-9567-e2b4-db4a735b06a8","targetPort":"src"},{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Enable Clip","targetId":"c2ed26c6-e7c0-c109-e83f-3e514b4c4b46","targetPort":"clip"},{"sourceId":"58e9a4a0-8f91-170e-a4d4-1aef7426cd65","sourcePort":"deltaY","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"DeltaY"},{"sourceId":"58e9a4a0-8f91-170e-a4d4-1aef7426cd65","sourcePort":"deltaX","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"DeltaX"},{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Zoom Out","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"ZoomOut"},{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Zoom In","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"ZoomIn"},{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Constraint To Container","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"ConstraintToParent"},{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Zoom Level","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"SuggestedZoomLevel"},{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Min Zoom Level","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"MinZoomLevel"},{"sourceId":"da291aae-3607-3b37-87dd-9348b957f2cb","sourcePort":"Max Zoom Level","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"MaxZoomLevel"},{"sourceId":"c2ed26c6-e7c0-c109-e83f-3e514b4c4b46","sourcePort":"boundingHeight","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"ContainerHeight"},{"sourceId":"c2ed26c6-e7c0-c109-e83f-3e514b4c4b46","sourcePort":"boundingWidth","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"ContainerWidth"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"ImageWidth","targetId":"a05ac464-5256-9567-e2b4-db4a735b06a8","targetPort":"width"},{"sourceId":"a05ac464-5256-9567-e2b4-db4a735b06a8","sourcePort":"onLoad","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"Init"},{"sourceId":"a05ac464-5256-9567-e2b4-db4a735b06a8","sourcePort":"this","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"ImageNode"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"VisibleXPos","targetId":"8c71216d-4e6f-5604-158e-a09d87aedfb2","targetPort":"X pos"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"VisibleYPos","targetId":"8c71216d-4e6f-5604-158e-a09d87aedfb2","targetPort":"Y pos"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"VisibleWidth","targetId":"8c71216d-4e6f-5604-158e-a09d87aedfb2","targetPort":"Width"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"VisibleHeight","targetId":"8c71216d-4e6f-5604-158e-a09d87aedfb2","targetPort":"Height"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"ViewUpdated","targetId":"8c71216d-4e6f-5604-158e-a09d87aedfb2","targetPort":"View Updated"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"ImageXpos","targetId":"a05ac464-5256-9567-e2b4-db4a735b06a8","targetPort":"transformX"},{"sourceId":"3747f096-2869-6950-7ad7-979ed3ce41cd","sourcePort":"ImageYpos","targetId":"a05ac464-5256-9567-e2b4-db4a735b06a8","targetPort":"transformY"},{"sourceId":"58e9a4a0-8f91-170e-a4d4-1aef7426cd65","sourcePort":"this","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"DragNode"},{"sourceId":"c2ed26c6-e7c0-c109-e83f-3e514b4c4b46","sourcePort":"hoverEnd","targetId":"3747f096-2869-6950-7ad7-979ed3ce41cd","targetPort":"CancelMultiTouch"}],"ports":[{"name":"X pos","type":"number","group":"Visible Image Area","plug":"output","index":0},{"name":"Zoom In","type":{"name":"signal"},"group":"Zoom Control","plug":"input","index":0},{"name":"Y pos","type":"number","group":"Visible Image Area","plug":"output","index":1},{"name":"Zoom Out","type":{"name":"signal"},"group":"Zoom Control","plug":"input","index":1},{"name":"Height","type":"number","group":"Visible Image Area","plug":"output","index":2},{"name":"Zoom Level","type":"number","group":"Zoom Control","plug":"input","index":2},{"name":"Width","type":"number","group":"Visible Image Area","plug":"output","index":3},{"name":"Max Zoom Level","type":"number","default":2,"group":"Zoom Control","plug":"input","index":3},{"name":"Current Zoom Level","type":"*","group":"Other","plug":"output","index":4},{"name":"Min Zoom Level","type":"number","default":0.5,"group":"Zoom Control","plug":"input","index":4},{"name":"View Updated","type":"signal","group":"Other","plug":"output","index":5},{"name":"Image","type":{"name":"image"},"group":"Other","plug":"input","index":5},{"name":"Enable Clip","type":"boolean","default":false,"group":"Other","plug":"input","index":6},{"name":"Constraint To Container","type":"boolean","default":true,"group":"Other","plug":"input","index":7}],"roots":["c2ed26c6-e7c0-c109-e83f-3e514b4c4b46"],"metadata":{"canvasPos":{"x":1094.8678633054747,"y":35.97288128726302},"canvasSize":{"width":"405px","height":"142px"}}},{"name":"/#XanoPrefab/Xano/Base/Xano - Request GEN In_Img","nodes":[{"id":"1e54d63d-d136-5645-8e47-da68a42d700f","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"6c0d383e-8855-a49a-bec8-fe3b40c9c0f8","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"ceb15c32-888b-41c7-30be-4587cb4649c2","type":"JavaScriptFunction","parameters":{"functionScript":"// Function to convert query parameters object to query string\nfunction toQueryString(params) {\n    return Object.keys(params)\n        .map(key => encodeURIComponent(key) + '=' + encodeURIComponent(params[key]))\n        .join('&');\n}\n\n// Prepare the query parameters object\nconst queryParams = {\n    user_id: Inputs.userId,\n    room: Inputs.room,\n    prompt: Inputs.prompt,\n    IMG: Inputs.img64 // Assuming 'img64' holds the necessary data for the image generation request\n};\n\n// Check for XanoClient existence\nif (!Boolean(Noodl.Variables.xano)) {\n    console.error('XanoClient does not exist! Check \"Setup XanoClient\"');\n    return;\n}\n\n// The endpoint is now hardcoded to the provided Xano API endpoint\nlet modifiedEndpoint = \"https://x8ki-letl-twmt.n7.xano.io/api:XoRzS70T/ImgGENimg\";\n\n// Assuming POST data should include query parameters - adjust as per your API requirement\nlet postData = queryParams; // Adjust this to match the API's expected data format\n\n// Make the POST API request\nNoodl.Variables.xano.post(modifiedEndpoint, postData).then(\n    (response) => {\n        Outputs.Response = response;\n        Outputs.Success();\n    },\n    (error) => {\n        console.error('API request failed:', error); // Log the error object or message\n        if (error.message) {\n            console.error('Error message:', error.message); // Log specific error message if available\n        }\n        Outputs.Failure();\n    }\n);\n"},"ports":[{"name":"in-userId","displayName":"userId","plug":"input","type":"*","group":"Inputs","index":4},{"name":"in-room","displayName":"room","plug":"input","type":"*","group":"Inputs","index":5},{"name":"in-prompt","displayName":"prompt","plug":"input","type":"*","group":"Inputs","index":6},{"name":"in-img64","displayName":"img64","plug":"input","type":"*","group":"Inputs","index":7},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":8},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":9},{"name":"out-Response","displayName":"Response","plug":"output","type":"*","group":"Outputs","index":10}],"children":[]},{"id":"8876da54-98f1-400a-c96c-3ff07b03931a","type":"States","parameters":{"states":"GET,POST,PATCH,PUT,DELETE,HEAD","values":"Request Type","useTransitions":false,"type-Request Type":"string","value-GET-Request Type":"get","value-POST-Request Type":"post","value-PATCH-Request Type":"patch","value-PUT-Request Type":"put","value-DELETE-Request Type":"delete","value-HEAD-Request Type":"head"},"ports":[],"children":[]},{"id":"95f353cd-400a-4378-aaad-836f99c5ed4c","type":"String","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"1e54d63d-d136-5645-8e47-da68a42d700f","sourcePort":"Request Type","targetId":"8876da54-98f1-400a-c96c-3ff07b03931a","targetPort":"currentState"},{"sourceId":"1e54d63d-d136-5645-8e47-da68a42d700f","sourcePort":"Do","targetId":"ceb15c32-888b-41c7-30be-4587cb4649c2","targetPort":"run"},{"sourceId":"1e54d63d-d136-5645-8e47-da68a42d700f","sourcePort":"Endpoint","targetId":"95f353cd-400a-4378-aaad-836f99c5ed4c","targetPort":"value"},{"sourceId":"ceb15c32-888b-41c7-30be-4587cb4649c2","sourcePort":"out-Success","targetId":"6c0d383e-8855-a49a-bec8-fe3b40c9c0f8","targetPort":"Success"},{"sourceId":"ceb15c32-888b-41c7-30be-4587cb4649c2","sourcePort":"out-Failure","targetId":"6c0d383e-8855-a49a-bec8-fe3b40c9c0f8","targetPort":"Failure"},{"sourceId":"ceb15c32-888b-41c7-30be-4587cb4649c2","sourcePort":"out-Response","targetId":"6c0d383e-8855-a49a-bec8-fe3b40c9c0f8","targetPort":"Response"},{"sourceId":"1e54d63d-d136-5645-8e47-da68a42d700f","sourcePort":"user id","targetId":"ceb15c32-888b-41c7-30be-4587cb4649c2","targetPort":"in-userId"},{"sourceId":"1e54d63d-d136-5645-8e47-da68a42d700f","sourcePort":"prompt","targetId":"ceb15c32-888b-41c7-30be-4587cb4649c2","targetPort":"in-prompt"},{"sourceId":"1e54d63d-d136-5645-8e47-da68a42d700f","sourcePort":"room","targetId":"ceb15c32-888b-41c7-30be-4587cb4649c2","targetPort":"in-room"},{"sourceId":"1e54d63d-d136-5645-8e47-da68a42d700f","sourcePort":"img","targetId":"ceb15c32-888b-41c7-30be-4587cb4649c2","targetPort":"in-img64"}],"ports":[{"name":"Response","type":"*","plug":"output","index":0},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":0},{"name":"Success","type":"signal","group":"Signals","plug":"output","index":1},{"name":"Endpoint","type":{"name":"string"},"default":"","group":"Request","plug":"input","index":1},{"name":"Error","type":"*","group":"Signals","plug":"output","index":2},{"name":"Request Type","type":{"name":"enum","enums":["GET","POST","PATCH","PUT","DELETE","HEAD"]},"default":"GET","group":"Request","plug":"input","index":2},{"name":"Failure","type":"signal","group":"Signals","plug":"output","index":3},{"name":"Data","type":"*","group":"Request","plug":"input","index":3},{"name":"Done","type":"*","group":"Signals","plug":"output","index":4},{"name":"user id","type":"*","group":"Request","plug":"input","index":4},{"name":"room","type":"*","group":"Request","plug":"input","index":5},{"name":"prompt","type":"*","group":"Request","plug":"input","index":6},{"name":"img","type":"*","group":"Request","plug":"input","index":7}],"roots":[]}]